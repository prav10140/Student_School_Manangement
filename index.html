<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Management Pro</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* 2. CSS RESET & VARIABLES */
        :root {
            --primary: #4e73df;      /* Modern Blue */
            --secondary: #858796;    /* Grey Text */
            --success: #1cc88a;      /* Green */
            --danger: #e74a3b;       /* Red */
            --dark: #2e3b4e;         /* Sidebar BG */
            --light: #f8f9fc;        /* Main BG */
            --white: #ffffff;
            --shadow: 0 4px 6px rgba(0,0,0,0.05);
            --radius: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        
        body { display: flex; height: 100vh; background-color: var(--light); color: #333; }

        /* 3. SIDEBAR DESIGN */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, #4e73df 10%, #224abe 100%);
            color: var(--white);
            display: flex;
            flex-direction: column;
            box-shadow: 4px 0 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .sidebar-brand {
            padding: 30px 20px;
            font-size: 1.4rem;
            font-weight: 600;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .sidebar-brand i { margin-right: 10px; color: #ffdf00; }

        .sidebar ul { list-style: none; padding-top: 20px; }
        
        .sidebar li {
            padding: 15px 25px;
            cursor: pointer;
            transition: 0.2s;
            font-size: 0.95rem;
            opacity: 0.8;
            display: flex;
            align-items: center;
        }

        .sidebar li i { margin-right: 15px; width: 20px; text-align: center; }
        
        .sidebar li:hover, .sidebar li.active {
            background: rgba(255,255,255,0.15);
            opacity: 1;
            border-left: 5px solid var(--white);
            font-weight: 500;
        }

        /* 4. MAIN CONTENT AREA */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header */
        .top-bar {
            background: var(--white);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            z-index: 10;
        }
        .user-info { display: flex; align-items: center; gap: 10px; font-weight: 500; }
        .user-avatar { width: 35px; height: 35px; background: #e2e6ea; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: var(--primary); }

        /* Scrollable Content */
        .content-scroll {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .section { display: none; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h2 { margin-bottom: 20px; color: #444; font-weight: 600; }

        /* 5. DASHBOARD CARDS */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--white);
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border-left: 5px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card:nth-child(2) { border-left-color: var(--success); }
        .card:nth-child(3) { border-left-color: #f6c23e; }
        .card:nth-child(4) { border-left-color: var(--danger); }

        .card-info h4 { color: var(--secondary); font-size: 0.85rem; text-transform: uppercase; margin-bottom: 5px; letter-spacing: 1px; }
        .card-info p { font-size: 1.8rem; font-weight: 700; color: #333; }
        .card-icon { font-size: 2rem; color: #dddfeb; }

        /* 6. FORMS (MODERN INPUTS) */
        .form-container {
            background: var(--white);
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #d1d3e2;
            border-radius: 8px;
            background: #f8f9fc;
            outline: none;
            transition: 0.3s;
        }

        input:focus, select:focus {
            border-color: var(--primary);
            background: var(--white);
            box-shadow: 0 0 0 3px rgba(78, 115, 223, 0.1);
        }

        button {
            padding: 12px 25px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover { background: #224abe; transform: translateY(-2px); }
        
        /* 7. TABLES */
        .table-container {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fc; color: var(--secondary); font-weight: 600; text-transform: uppercase; font-size: 0.85rem; padding: 15px; text-align: left; }
        td { padding: 15px; border-top: 1px solid #e3e6f0; color: #555; font-size: 0.95rem; }
        tr:hover { background: #fafafa; }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .status-present { background: #d1fae5; color: #065f46; }
        .status-absent { background: #fee2e2; color: #991b1b; }
        .btn-del { background: #e74a3b; padding: 6px 12px; font-size: 0.8rem; }
        .btn-del:hover { background: #c0392b; }

    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-brand">
            <i class="fas fa-graduation-cap"></i> EduSmart
        </div>
        <ul>
            <li class="active" onclick="show('dashboard', this)">
                <i class="fas fa-chart-line"></i> <span>Dashboard</span>
            </li>
            <li onclick="show('classes', this)">
                <i class="fas fa-chalkboard"></i> <span>Classes</span>
            </li>
            <li onclick="show('students', this)">
                <i class="fas fa-user-graduate"></i> <span>Students</span>
            </li>
            <li onclick="show('teachers', this)">
                <i class="fas fa-chalkboard-teacher"></i> <span>Teachers</span>
            </li>
            <li onclick="show('attendance', this)">
                <i class="fas fa-calendar-check"></i> <span>Attendance</span>
            </li>
            <li onclick="show('fees', this)">
                <i class="fas fa-file-invoice-dollar"></i> <span>Fee Status</span>
            </li>
        </ul>
    </div>

    <div class="main">
        
        <div class="top-bar">
            <h3>Admin Panel</h3>
            <div class="user-info">
                <span>Administrator</span>
                <div class="user-avatar"><i class="fas fa-user"></i></div>
            </div>
        </div>

        <div class="content-scroll">

            <div id="dashboard" class="section active">
                <h2>System Overview</h2>
                <div class="cards-grid">
                    <div class="card">
                        <div class="card-info"><h4>Total Students</h4><p id="dash-stu-count">Loading...</p></div>
                        <div class="card-icon"><i class="fas fa-users"></i></div>
                    </div>
                    <div class="card">
                        <div class="card-info"><h4>Teachers</h4><p id="dash-tea-count">Loading...</p></div>
                        <div class="card-icon"><i class="fas fa-user-tie"></i></div>
                    </div>
                    <div class="card">
                        <div class="card-info"><h4>Active Classes</h4><p id="dash-cls-count">Loading...</p></div>
                        <div class="card-icon"><i class="fas fa-school"></i></div>
                    </div>
                    <div class="card">
                        <div class="card-info"><h4>System Status</h4><p style="color:#1cc88a; font-size:1.2rem">Online</p></div>
                        <div class="card-icon"><i class="fas fa-signal"></i></div>
                    </div>
                </div>
                
                <div class="form-container">
                    <h3 style="margin-bottom:15px; color:#555">Welcome Back!</h3>
                    <p style="color:#666; line-height:1.6">Manage your school efficiently using the sidebar menu. All records are synced with your SQL database in real-time.</p>
                </div>
            </div>

            <div id="classes" class="section">
                <h2>Manage Classes</h2>
                <div class="form-container">
                    <div class="form-grid">
                        <input type="text" id="cls-name" placeholder="Class Name (e.g. Grade 10-A)">
                        <select id="cls-teacher"><option value="">Loading Teachers...</option></select>
                    </div>
                    <button onclick="addClass()"><i class="fas fa-plus"></i> Create Class</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>ID</th><th>Class Name</th><th>Assigned Teacher</th></tr></thead>
                        <tbody id="list-cls"></tbody>
                    </table>
                </div>
            </div>

            <div id="students" class="section">
                <h2>Student Records</h2>
                <div class="form-container">
                    <div class="form-grid">
                        <input type="text" id="stu-fname" placeholder="First Name">
                        <input type="text" id="stu-lname" placeholder="Last Name">
                        <input type="date" id="stu-dob">
                        <input type="text" id="stu-contact" placeholder="Contact Number">
                        <select id="stu-class"><option value="">Select Class</option></select>
                    </div>
                    <button onclick="addStudent()"><i class="fas fa-user-plus"></i> Enroll Student</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>ID</th><th>Full Name</th><th>Class</th><th>Contact</th><th>Action</th></tr></thead>
                        <tbody id="list-stu"></tbody>
                    </table>
                </div>
            </div>

            <div id="teachers" class="section">
                <h2>Teacher Staff</h2>
                <div class="form-container">
                    <div class="form-grid">
                        <input type="text" id="tea-fname" placeholder="First Name">
                        <input type="text" id="tea-lname" placeholder="Last Name">
                        <input type="text" id="tea-sub" placeholder="Subject">
                        <input type="email" id="tea-email" placeholder="Email Address">
                        <input type="text" id="tea-phone" placeholder="Phone Number">
                    </div>
                    <button onclick="addTeacher()"><i class="fas fa-briefcase"></i> Add Teacher</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>ID</th><th>Name</th><th>Specialization</th><th>Email</th></tr></thead>
                        <tbody id="list-tea"></tbody>
                    </table>
                </div>
            </div>

            <div id="attendance" class="section">
                <h2>Daily Attendance</h2>
                <div class="form-container">
                    <div class="form-grid">
                        <select id="att-student"><option value="">Select Student</option></select>
                        <input type="date" id="att-date">
                        <select id="att-status">
                            <option value="Present">Present</option>
                            <option value="Absent">Absent</option>
                            <option value="Late">Late</option>
                        </select>
                    </div>
                    <button onclick="markAttendance()"><i class="fas fa-check-circle"></i> Mark Attendance</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>Student</th><th>Date</th><th>Status</th></tr></thead>
                        <tbody id="list-att"></tbody>
                    </table>
                </div>
            </div>

            <div id="fees" class="section">
                <h2>Fee Collection</h2>
                <div class="form-container">
                    <div class="form-grid">
                        <select id="fee-student"><option value="">Select Student</option></select>
                        <input type="number" id="fee-amount" placeholder="Amount ($)">
                        <input type="date" id="fee-date">
                        <select id="fee-status">
                            <option value="Pending">Pending</option>
                            <option value="Paid">Paid</option>
                            <option value="Overdue">Overdue</option>
                        </select>
                    </div>
                    <button onclick="addFee()"><i class="fas fa-coins"></i> Record Payment</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>Student</th><th>Amount</th><th>Status</th><th>Due Date</th></tr></thead>
                        <tbody id="list-fee"></tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <script>
        const API = "http://localhost:3000/api";

        // --- UI NAVIGATION ---
        function show(id, element) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            // Highlight sidebar item
            if(element) {
                document.querySelectorAll('.sidebar li').forEach(li => li.classList.remove('active'));
                element.classList.add('active');
            }
        }

        // --- DASHBOARD COUNTERS ---
        function updateDashboard(students, teachers, classes) {
            if(students) document.getElementById('dash-stu-count').innerText = students.length;
            if(teachers) document.getElementById('dash-tea-count').innerText = teachers.length;
            if(classes) document.getElementById('dash-cls-count').innerText = classes.length;
        }

        // --- LOAD DROPDOWNS ---
        async function loadDropdowns() {
            try {
                const teachers = await (await fetch(API + '/teachers')).json();
                const teaSelect = document.getElementById('cls-teacher');
                teaSelect.innerHTML = '<option value="">Select Teacher</option>';
                teachers.forEach(t => teaSelect.innerHTML += `<option value="${t.teacher_id}">${t.first_name} ${t.last_name}</option>`);

                const classes = await (await fetch(API + '/classes')).json();
                const clsSelect = document.getElementById('stu-class');
                clsSelect.innerHTML = '<option value="">Select Class</option>';
                classes.forEach(c => clsSelect.innerHTML += `<option value="${c.class_id}">${c.class_name}</option>`);

                const students = await (await fetch(API + '/students')).json();
                const attSelect = document.getElementById('att-student');
                const feeSelect = document.getElementById('fee-student');
                let stuOptions = '<option value="">Select Student</option>';
                students.forEach(s => stuOptions += `<option value="${s.student_id}">${s.first_name} ${s.last_name}</option>`);
                attSelect.innerHTML = stuOptions;
                feeSelect.innerHTML = stuOptions;

                updateDashboard(students, teachers, classes);
            } catch (e) { console.error("Connection Error"); }
        }

        // --- DATA LOADERS ---
        async function loadAll() {
            await loadDropdowns();
            loadClasses();
            loadStudents();
            loadTeachers();
            loadAttendance();
            loadFees();
        }

        // 1. CLASSES
        async function loadClasses() {
            const data = await (await fetch(API + '/classes')).json();
            document.getElementById('list-cls').innerHTML = data.map(c => 
                `<tr><td>#${c.class_id}</td><td><b>${c.class_name}</b></td><td>${c.teacher_name || '<span style="color:red">No Teacher</span>'}</td></tr>`
            ).join('');
        }
        async function addClass() {
            const name = document.getElementById('cls-name').value;
            const tid = document.getElementById('cls-teacher').value;
            if(!name) return alert("Class Name required");
            await fetch(API + '/classes', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({class_name:name, teacher_id:tid})});
            alert("Class Added!"); loadAll();
        }

        // 2. STUDENTS
        async function loadStudents() {
            const data = await (await fetch(API + '/students')).json();
            document.getElementById('list-stu').innerHTML = data.map(s => 
                `<tr>
                    <td>#${s.student_id}</td>
                    <td><b>${s.first_name} ${s.last_name}</b></td>
                    <td>${s.class_name || '<span style="color:red">Unassigned</span>'}</td>
                    <td>${s.contact_number}</td>
                    <td><button class="btn-del" onclick="delStudent(${s.student_id})"><i class="fas fa-trash"></i></button></td>
                </tr>`
            ).join('');
        }
        async function addStudent() {
            const body = {
                first_name: document.getElementById('stu-fname').value,
                last_name: document.getElementById('stu-lname').value,
                dob: document.getElementById('stu-dob').value,
                contact_number: document.getElementById('stu-contact').value,
                class_id: document.getElementById('stu-class').value
            };
            if(!body.first_name || !body.class_id) return alert("Name & Class required");
            await fetch(API + '/students', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)});
            alert("Student Added!"); loadAll();
        }
        async function delStudent(id) {
            if(confirm("Delete this student record?")) { await fetch(API+'/students/'+id, {method:'DELETE'}); loadAll(); }
        }

        // 3. TEACHERS
        async function loadTeachers() {
            const data = await (await fetch(API + '/teachers')).json();
            document.getElementById('list-tea').innerHTML = data.map(t => 
                `<tr><td>#${t.teacher_id}</td><td><b>${t.first_name} ${t.last_name}</b></td><td>${t.subject_specialization}</td><td>${t.email || '-'}</td></tr>`
            ).join('');
        }
        async function addTeacher() {
            const body = {
                first_name: document.getElementById('tea-fname').value,
                last_name: document.getElementById('tea-lname').value,
                subject: document.getElementById('tea-sub').value,
                email: document.getElementById('tea-email').value,
                phone: document.getElementById('tea-phone').value
            };
            await fetch(API + '/teachers', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)});
            alert("Teacher Added!"); loadAll();
        }

        // 4. ATTENDANCE
        async function loadAttendance() {
            const data = await (await fetch(API + '/attendance')).json();
            document.getElementById('list-att').innerHTML = data.map(a => {
                const statusClass = a.status === 'Present' ? 'status-present' : 'status-absent';
                return `<tr>
                    <td>${a.first_name} ${a.last_name}</td>
                    <td>${new Date(a.date).toLocaleDateString()}</td>
                    <td><span class="status-badge ${statusClass}">${a.status}</span></td>
                </tr>`;
            }).join('');
        }
        async function markAttendance() {
            const body = {
                student_id: document.getElementById('att-student').value,
                date: document.getElementById('att-date').value,
                status: document.getElementById('att-status').value
            };
            if(!body.student_id || !body.date) return alert("Select Student & Date");
            await fetch(API + '/attendance', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)});
            alert("Attendance Marked!"); loadAttendance();
        }

        // 5. FEES
        async function loadFees() {
            const data = await (await fetch(API + '/fees')).json();
            document.getElementById('list-fee').innerHTML = data.map(f => 
                `<tr><td>${f.first_name} ${f.last_name}</td><td>$${f.amount}</td>
                <td><span style="font-weight:bold; color:${f.status === 'Paid' ? 'green' : 'red'}">${f.status}</span></td>
                <td>${new Date(f.due_date).toLocaleDateString()}</td></tr>`
            ).join('');
        }
        async function addFee() {
            const body = {
                student_id: document.getElementById('fee-student').value,
                amount: document.getElementById('fee-amount').value,
                status: document.getElementById('fee-status').value,
                due_date: document.getElementById('fee-date').value
            };
            if(!body.student_id || !body.amount) return alert("Details required");
            await fetch(API + '/fees', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)});
            alert("Fee Record Added!"); loadFees();
        }

        // INIT
        loadAll();
    </script>
</body>
</html>